import os
from os.path import exists
from PIL import Image, ImageDraw
import shutil

def change_pixels_to_color(image, coords, color):
    pixels = image.load()

    for c in coords:
        if len(c) == 2:
            #single pixel
            pixels[c[0], c[1]] = color
        if len(c) == 4:
            #rectangle
            for x in range(c[0], c[2] + 1):
                for y in range(c[1], c[3] + 1):
                    pixels[x, y] = color

    return image

def change_pixels_to_black(image, coords):
    return change_pixels_to_color(image, coords, 0)

def change_pixels_to_white(image, coords):
    return change_pixels_to_color(image, coords, 255)

files = [
"00096", "00097", "00155", "00166", "00214", "00331", "00342", "00392", "00395", "00400", "00431",
"00449", "00451", "00468", "00473", "00484", "00611", "00651", "00701", "00838", "00866", "00899",
"00984", "01007", "01021", "01104", "01116", "01208", "01212", "01229", "01270", "01288", "01373",
"01444", "01452", "01473", "01494", "01513", "01518", "01536", "01573", "01591", "01707", "01793",
"01841", "01992", "02034", "02046", "02089", "02185", "02275", "02279", "02370", "02485", "02578",
"02582", "02595", "02614", "02617", "02635", "02665", "02688", "02695", "02727", "02755", "02797",
"03036", "03269", "03445", "03503", "03507", "03522", "03595", "03753", "03761", "03767", "03770",
"03844", "03850", "03884", "03899", "03915", "04017", "04259", "04611", "04612", "04643", "04657",
"04661", "04794", "04808", "04859", "04905", "04962", "04976", "04978", "05011", "05032", "05034",
"05035", "05040", "05060", "05070", "05081", "05095", "05235", "05385", "05521", "05553", "05726",
"05756", "05910", "05978", "05995", "06009", "06112", "06129", "06162", "06164", "06186", "06214",
"06225", "06228", "06323", "06334", "06350", "06356", "06444", "06494", "06679", "06751", "06802",
"07216", "07219", "07221", "07249", "07258", "07265", "07273", "07284", "07336", "07353", "07381",
"07523", "07533", "07704", "07811", "07908", "07915", "07932", "07942", "08053", "08187", "08235",
"08238", "08260", "08280", "08315", "08336", "08338", "08364", "08395", "08398", "08401", "08406",
"08413", "08416", "08420", "08428", "08436", "08456", "08463", "08466", "08501", "08564", "08694",
"09122", "09296", "09299", "09391", "09477", "09514", "09516", "09521", "09542", "09656", "09684",
"09694", "09713", "09732", "09766", "09774", "09907", "09996", "10031", "10064", "10094", "10183",
"10185", "10282", "10350", "10404", "10454", "10600", "10632", "10642", "10651", "10683", "10776",
"10804", "10816", "10820", "10893", "10967", "10970", "10980", "11029", "11042", "11062", "11065",
"11088", "11103", "11105", "11109", "11115", "11131", "11139", "11153", "11184", "11187", "11190",
"11191", "11208", "11249", "11338", "11439", "11453", "11572", "11836", "11949"
]

files_needing_reconstruction = [
"02034", "03445"
]

pixels = [
[[18, 0]],
[[61, 27], [62, 27]],
[[24, 0], [24,1]],
[[4, 2]],
[[21, 1], [22, 2]],
[[15, 32]],
[[46, 48], [47, 48]],
[[5, 0], [6, 0]],
[[3, 0], [3, 1], [3, 2], [4, 1]],
[[0, 0, 63, 5]],
[[3, 0]],
[[14, 0], [14, 1], [14, 2]],
[[31, 7], [31, 8]],
[[0, 0, 63, 7]],
[[3, 47]],
[[14, 44]],
[[27, 10]],
[[51, 4, 52, 7]],
[[12, 21], [12, 22]],
[[27, 39]],
[[18, 1]],
[[25, 54, 26, 58]],
[[15, 12, 16, 15], [10, 31], [10, 32]],
[[7, 40, 9, 48]],
[[25, 14], [24, 15], [24, 16]],
[[9, 1]],
[[1, 12], [1, 13]],
[[8, 0]],
[[26, 18, 27, 19]],
[[12, 0], [13, 0]],
[[48, 34]],
[[52, 36, 53, 37]],
[[21, 27, 23, 29]],
[[40, 17]],
[[23, 0, 59, 3]],
[[5, 0]],
[[0, 0, 28, 2]],
[[31, 0, 49, 3]],
[[0, 50, 42, 62], [43, 61, 60, 62]],
[[14, 40, 15, 43]],
[[6, 0, 39, 1]],
[[26, 0, 28, 20]],
[[25, 0]],
[[51, 0]],
[[51, 9], [52, 9]],
[[12, 14]],
[[41, 14, 45, 16], [39, 15, 40, 16], [37, 16, 39, 17], [35, 17, 36, 18], [29, 19, 32, 20], [28, 20, 29, 21], [25, 22], [26, 22], [27, 22], [32, 18], [27, 21], [27, 20], [26, 21], [35, 19]],
[[3, 19, 4, 20]],
[[27, 0, 29, 1]],
[[24, 38, 25, 40]],
[[2, 4]],
[[0, 47, 1, 48]],
[[49, 0, 50, 1]],
[[25, 17, 26, 19]],
[[16, 6]],
[[15, 0]],
[[1, 61, 3, 62]],
[[4, 0], [4, 3]],
[[3, 0, 7, 2]],
[[0, 0, 62, 6]],
[[59, 14, 60, 15]],
[[0, 0, 15, 6]],
[[36, 0], [37, 0]],
[[10, 40, 12, 43]],
[[10, 12, 14, 17]],
[[17, 12], [17, 13], [17, 14]],
[[25, 26]],
[[9, 10], [9, 11]],
[[22, 52], [23, 52], [23, 53], [24, 52], [24, 53], [24, 54], [25, 52], [25, 53], [25, 54], [25, 55], [26, 53], [26, 54], [26, 55], [26, 56], [27, 54], [27, 55], [27, 56], [28, 55], [28, 56], [28, 57], [29, 55], [29, 56], [29, 57], [30, 56], [30, 57], [30, 58], [31, 56], [31, 57], [31, 58], [32, 57], [32, 58], [32, 59], [33, 57], [33, 58], [33, 59], [34, 58], [34, 59], [34, 60], [35, 58], [35, 59], [35, 60], [36, 59], [36, 60], [37, 59], [37, 60], [38, 59], [38, 60], [39, 59], [39, 60], [40, 59], [40, 60], [41, 59], [41, 60], [42, 59], [42, 60], [43, 58], [43, 59], [43, 60], [44, 58], [44, 59], [45, 58], [45, 59], [46, 57], [46, 58], [46, 59], [47, 57], [47, 58], [48, 56], [48, 57], [48, 58], [49, 56], [49, 57], [50, 55], [50, 56], [50, 57], [51, 55], [51, 56], [52, 54], [52, 55], [52, 56], [53, 54], [53, 55], [54, 53], [54, 54], [54, 55], [55, 53], [55, 54], [56, 52], [56, 53], [57, 52], [57, 53], [58, 52]],
[[2, 26, 3, 29]],
[[25, 60, 28, 62]],
[[38, 16]],
[[4, 0, 50, 2]],
[[0, 60, 43, 62], [21, 57]],
[[60, 0]],
[[2, 33]],
[[13, 0], [13, 1]],
[[59, 47]],
[[5, 29, 7, 31]],
[[40, 0, 41, 1]],
[[61, 0]],
[[38, 1]],
[[55, 11]],
[[24, 2]],
[[8, 3, 13, 9]],
[[21, 17]],
[[35, 0, 36, 2]],
[[4, 0, 50, 4]],
[[3, 0, 18, 5]],
[[13, 31], [13, 32]],
[[34, 0, 35, 1]],
[[51, 23]],
[[26, 52, 29, 54]],
[[3, 0, 4, 1]],
[[2, 0, 35, 1]],
[[57, 0]],
[[3, 0, 29, 1]],
[[11, 22, 12, 24]],
[[11, 0], [12, 0], [13, 0]],
[[0, 48, 33, 61], [34, 55, 56, 61]],
[[2, 0, 14, 4]],
[[9, 53], [10, 53], [11, 53]],
[[4, 0, 44, 2]],
[[2, 0, 22, 1]],
[[0, 0, 14, 3]],
[[53, 30, 62, 35]],
[[29, 0], [29, 1]],
[[25, 5, 27, 7], [47, 0]],
[[43, 40], [43, 41]],
[[62, 50]],
[[0, 17, 1, 19]],
[[25, 13]],
[[24, 0, 62, 3]],
[[44, 0]],
[[10, 5], [48, 0, 60, 5]],
[[16, 1]],
[[0, 0, 19, 4]],
[[1, 4, 3, 8]],
[[14, 0]],
[[0, 57, 41, 62]],
[[0, 0, 36, 5]],
[[0, 52, 16, 61], [17, 54, 61, 61]],
[[7, 0], [3, 2]],
[[9, 10, 11, 12]],
[[15, 0, 17, 1]],
[[32, 13], [33, 14]],
[[15, 10, 17, 12]],
[[2, 46]],
[[36, 6, 42, 10], [43, 10]],
[[28, 27], [29, 27]],
[[0, 28], [1, 28]],
[[6, 24]],
[[29, 0]],
[[12, 0, 37, 5]],
[[0, 2, 62, 13], [9, 14, 13, 17], [0, 56, 43, 62]],
[[58, 0]],
[[7, 0, 53, 5]],
[[35, 0]],
[[14, 0], [14, 1]],
[[19, 0, 20, 2]],
[[37, 61, 47, 62]],
[[46, 0, 50, 3]],
[[3, 0, 46, 2]],
[[0, 3]],
[[8, 39, 12, 44]],
[[59, 17, 60, 18], [8, 29, 10, 30]],
[[26, 10]],
[[11, 28]],
[[12, 12]],
[[50, 5], [50, 6]],
[[10, 38, 11, 40]],
[[60, 6, 62, 8]],
[[9, 0, 12, 1]],
[[6, 0, 51, 3]],
[[44, 0, 60, 6]],
[[37, 0, 38, 2]],
[[0, 47, 2, 48]],
[[10, 31], [11, 31], [12, 31]],
[[0, 0], [2, 0], [4, 0]],
[[8, 0], [9, 0], [26, 0], [27, 0], [30, 0], [40, 0], [41, 0]],
[[21, 16], [56, 28, 57, 30]],
[[1, 0, 61, 3]],
[[47, 13, 48, 15], [0, 55, 36, 62]],
[[2, 0, 30, 1]],
[[38, 1, 52, 2]],
[[5, 0], [6, 0]],
[[6, 0, 14, 1]],
[[0, 1, 62, 13], [0, 57, 37, 62]],
[[0, 0, 15, 4]],
[[5, 0, 31, 1]],
[[40, 14, 41, 17]],
[[0, 54, 18, 62]],
[[10, 61, 15, 62]],
[[43, 0], [43, 1]],
[[16, 16]],
[[8, 35]],
[[61, 56]],
[[17, 0, 18, 2]],
[[60, 0]],
[[23, 0], [24, 0], [25, 0]],
[[2, 0, 38, 1]],
[[4, 5, 11, 7], [14, 15, 15, 18]],
[[19, 11, 20, 15]],
[[20, 0]],
[[35, 0, 36, 1]],
[[34, 0, 35, 2]],
[[34, 36]],
[[7, 0, 61, 2]],
[[22, 0]],
[[61, 50, 62, 51]],
[[10, 35], [10, 36]],
[[27, 1], [25, 16, 27, 18], [53, 18], [53, 19], [53, 20]],
[[11, 36]],
[[6, 30, 18, 33]],
[[62, 9], [62, 10]],
[[5, 31]],
[[26, 0], [26, 1]],
[[20, 14], [20, 15]],
[[29, 0]],
[[28, 0], [29, 0]],
[[43, 0]],
[[58, 0, 59, 1]],
[[53, 50], [54, 50]],
[[13, 0, 14, 1]],
[[35, 24], [35, 25]],
[[54, 62]],
[[13, 44], [14, 44]],
[[22, 3]],
[[27, 0], [27, 1]],
[[57, 0]],
[[21, 54]],
[[31, 1, 37, 3]],
[[48, 0, 60, 2]],
[[32, 0]],
[[2, 1], [3, 1]],
[[15, 37], [15, 38]],
[[43, 31], [43, 32]],
[[45, 0, 57, 11]],
[[1, 2, 62, 7]],
[[20, 59, 22, 62]],
[[6, 0, 7, 1]],
[[16, 0], [17, 0], [18, 0]],
[[3, 0, 4, 2]],
[[21, 0, 23, 3]],
[[0, 0, 10, 2], [7, 60, 16, 62]],
[[24, 59], [25, 59]],
[[12, 0, 13, 2]],
[[0, 0, 48, 12]],
[[0, 0, 30, 4]],
[[7, 0, 48, 4]],
[[2, 61, 11, 62]],
[[1, 0, 10, 2]],
[[12, 12]],
[[0, 61], [0, 62]],
[[28, 23, 30, 24]],
[[22, 15], [23, 15], [21, 56]],
[[14, 0], [14, 1]],
[[4, 51, 5, 52]],
[[11, 34], [11, 35], [11, 36]],
[[5, 0, 7, 2]]
]

if __name__ == "__main__":

    if exists("clean_hiragana"):
        print("Directory 'clean_hiragana' already exists.")
        quit()

    os.mkdir("clean_hiragana")

    for f in os.listdir("extracted_hiragana"):
        if os.path.isfile("extracted_hiragana/" + f) and f.endswith(".png"):
            if f[:-4] not in files:
                shutil.copy("extracted_hiragana/" + f, "clean_hiragana")

    for i in range(len(files)):
        with Image.open("extracted_hiragana/" + files[i] + ".png") as image:
            if files[i] not in files_needing_reconstruction:
                fixed_image = change_pixels_to_black(image, pixels[i])
                fixed_image.save("clean_hiragana/" + files[i] + ".png")
            else:
                if files[i] == files_needing_reconstruction[0]:
                    fixed_image = change_pixels_to_white(image, pixels[i])
                    fixed_image.save("clean_hiragana/" + files[i] + ".png")
                if files[i] == files_needing_reconstruction[1]:
                    fixed_image = Image.new('L', (image.size[0], image.size[1]), 0)
                    fixed_image.paste(image, (0, -10))
                    fixed_image = change_pixels_to_white(fixed_image, pixels[i])
                    fixed_image.save("clean_hiragana/" + files[i] + ".png")
